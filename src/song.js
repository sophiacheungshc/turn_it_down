export default class Song {

    constructor(ctx) {
        
        this.ctx = ctx;

        if (document.getElementById('sunflower-song').checked){
            console.log('sunflower');
            this.music = document.getElementById('sunflower');
        } else {
            this.music = document.getElementById('faded');
        }

        this.alert = new Image();
        this.alert.src = "img/spacebar.png";

        this.beats = 
            [3.213065, 3.872749, 4.187596, 5.204652, 5.887114, 6.538934, 6.857041, 7.83132, 8.495047, 9.192563, 9.531511, 10.511366, 11.21205, 11.863047, 12.190406, 13.162107, 13.858648, 14.528459, 14.871855, 15.827137, 16.521702, 17.237666, 17.556692, 18.504399, 19.176457, 19.846555, 20.182578, 21.181199, 21.86326, 22.50438, 22.846213, 23.802691, 24.509204, 25.140981, 25.490467, 26.505405, 27.205429, 27.878758, 28.189615, 29.122952, 29.810234, 30.509916, 30.837726, 31.822042, 32.515678, 33.203755, 33.499801, 34.48136, 35.138477, 35.861624, 36.197783, 37.162338, 37.843591, 38.507225, 38.84504, 39.807029, 40.490618, 41.197643, 41.501018, 42.471219, 43.169383, 43.832087, 44.178929, 45.150966, 45.843932, 46.504432, 46.863542, 47.833257, 48.494831, 49.213469, 49.5436, 50.539229, 51.204529, 51.875948, 52.180751, 53.163717, 53.899981, 54.556327, 54.871625, 55.808203, 56.531162, 57.213934, 57.533856, 58.529806, 59.196462, 60.151946, 61.204714, 61.860038, 62.810738, 63.85, 64.478658, 65.480043, 66.535709, 67.160534, 68.159383, 69.215001, 69.90153, 70.527071, 70.876908, 71.868999, 72.51437, 73.204648, 73.535515, 74.52083, 75.206741, 75.872538, 76.221395, 77.219098, 77.879155, 78.566581, 78.908685, 79.8289, 80.528895, 81.154682, 81.527547, 82.542067, 83.218459, 83.901569, 84.209898, 85.171399, 85.901184, 86.552779, 86.903477, 87.865072, 88.533905, 89.193634, 89.544027, 90.481812, 91.222037, 92.186578, 95.897609, 96.498016, 97.162701, 97.507769, 98.555856, 99.216271, 99.832508, 100.185126, 101.189058, 101.846306, 102.545891, 102.879379, 103.882544, 104.550926, 105.205295, 105.522301, 106.546095, 107.207112, 107.86688, 108.212636, 109.195663, 109.864431, 110.523722, 110.867807, 111.83902, 123.192882, 123.858931, 124.196055, 125.198947, 125.862995, 126.530771, 126.88162, 127.838581, 128.531995, 129.194814, 129.554865, 130.523532, 131.207737, 131.832705, 132.187441, 133.210455, 133.829802, 134.488314, 134.83457, 135.755137, 136.560037, 137.227001, 137.590749, 138.490381, 139.179974, 139.854018, 140.200925, 141.215266, 141.832674, 142.502263, 142.856791, 143.872584]
    }

    play(){
        this.music.play();
    }

    currentTime(){
        return this.music.currentTime;
    }

    pause(){
        this.music.pause();
    }

    onBeat(){
        let needaDuck = false;
        let time = this.currentTime();

        for(let i = 0; i <= this.beats.length; i++){
            if (time >= this.beats[i] - 0.15 && time <= this.beats[i] + 0.05) {
                this.ctx.drawImage(this.alert, 0, 0, 150, 56, 180, 0, 150, 56);
            }
            if (time >= this.beats[i] - 0.05 && time <= this.beats[i] + 0.05) {
                needaDuck = true;
                break;
            } 
        }

        return needaDuck;
    }
}
